<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--Rendered using the Haskell Html Library v0.2-->
<HTML
><HEAD
  ><TITLE
    >GHC.Weak</TITLE
    ><LINK HREF = "haddock.css" REL = "stylesheet" TYPE = "text/css"
    ></HEAD
  ><BODY
  ><TABLE CLASS = "vanilla" CELLSPACING = "0" CELLPADDING = "0"
    ><TR
      ><TD CLASS = "topbar"
	><TABLE CLASS = "vanilla" CELLSPACING = "0" CELLPADDING = "0"
	  ><TR
	    ><TD
	      ><IMG SRC = "haskell_icon.gif" WIDTH = "16" HEIGHT = "16" ALT = " "
		></TD
	      ><TD CLASS = "title"
	      >Haskell Hierarchical Libraries (base package)</TD
	      ><TD CLASS = "topbut"
	      ><A HREF = "../index.html"
		>Contents</A
		></TD
	      ><TD CLASS = "topbut"
	      ><A HREF = "../doc-index.html"
		>Index</A
		></TD
	      ></TR
	    ></TABLE
	  ></TD
	></TR
      ><TR
      ><TD CLASS = "modulebar"
	><TABLE CLASS = "vanilla" CELLSPACING = "0" CELLPADDING = "0"
	  ><TR
	    ><TD
	      ><FONT SIZE = "6"
		>GHC.Weak</FONT
		></TD
	      ><TD ALIGN = "right"
	      ><TABLE CLASS = "narrow" CELLSPACING = "0" CELLPADDING = "0"
		><TR
		  ><TD CLASS = "infohead"
		    >Portability</TD
		    ><TD CLASS = "infoval"
		    >  non-portable (GHC Extensions)</TD
		    ></TR
		  ><TR
		  ><TD CLASS = "infohead"
		    >Stability</TD
		    ><TD CLASS = "infoval"
		    >  internal</TD
		    ></TR
		  ><TR
		  ><TD CLASS = "infohead"
		    >Maintainer</TD
		    ><TD CLASS = "infoval"
		    >  cvs-ghc@haskell.org</TD
		    ></TR
		  ></TABLE
		></TD
	      ></TR
	    ></TABLE
	  ></TD
	></TR
      ><TR
      ><TD CLASS = "s15"
	></TD
	></TR
      ><TR
      ><TD
	><TABLE CLASS = "vanilla" CELLSPACING = "0" CELLPADDING = "0"
	  ></TABLE
	  ></TD
	></TR
      ><TR
      ><TD CLASS = "s15"
	></TD
	></TR
      ><TR
      ><TD CLASS = "section1"
	>Description</TD
	></TR
      ><TR
      ><TD CLASS = "doc"
	>Weak pointers.
</TD
	></TR
      ><TR
      ><TD CLASS = "s15"
	></TD
	></TR
      ><TR
      ><TD CLASS = "section1"
	>Synopsis</TD
	></TR
      ><TR
      ><TD CLASS = "s15"
	></TD
	></TR
      ><TR
      ><TD CLASS = "body"
	><TABLE CLASS = "vanilla" CELLSPACING = "0" CELLPADDING = "0"
	  ><TR
	    ><TD CLASS = "decl"
	      ><SPAN CLASS = "keyword"
		>data</SPAN
		> <A HREF = "#t%3AWeak"
		>Weak</A
		> v = <A HREF = "#v%3AWeak"
		>Weak</A
		> (Weak# v)</TD
	      ></TR
	    ><TR
	    ><TD CLASS = "s8"
	      ></TD
	      ></TR
	    ><TR
	    ><TD CLASS = "decl"
	      ><A HREF = "#v%3AmkWeak"
		>mkWeak</A
		> :: k -&gt; v -&gt; <A HREF = "Data.Maybe.html#t%3AMaybe"
		>Maybe</A
		> (<A HREF = "GHC.IOBase.html#t%3AIO"
		>IO</A
		> ()) -&gt; <A HREF = "GHC.IOBase.html#t%3AIO"
		>IO</A
		> (<A HREF = "GHC.Weak.html#t%3AWeak"
		>Weak</A
		> v)</TD
	      ></TR
	    ><TR
	    ><TD CLASS = "s8"
	      ></TD
	      ></TR
	    ><TR
	    ><TD CLASS = "decl"
	      ><A HREF = "#v%3AdeRefWeak"
		>deRefWeak</A
		> :: <A HREF = "GHC.Weak.html#t%3AWeak"
		>Weak</A
		> v -&gt; <A HREF = "GHC.IOBase.html#t%3AIO"
		>IO</A
		> (<A HREF = "Data.Maybe.html#t%3AMaybe"
		>Maybe</A
		> v)</TD
	      ></TR
	    ><TR
	    ><TD CLASS = "s8"
	      ></TD
	      ></TR
	    ><TR
	    ><TD CLASS = "decl"
	      ><A HREF = "#v%3Afinalize"
		>finalize</A
		> :: <A HREF = "GHC.Weak.html#t%3AWeak"
		>Weak</A
		> v -&gt; <A HREF = "GHC.IOBase.html#t%3AIO"
		>IO</A
		> ()</TD
	      ></TR
	    ><TR
	    ><TD CLASS = "s8"
	      ></TD
	      ></TR
	    ><TR
	    ><TD CLASS = "decl"
	      ><A HREF = "#v%3ArunFinalizerBatch"
		>runFinalizerBatch</A
		> :: <A HREF = "GHC.Base.html#t%3AInt"
		>Int</A
		> -&gt; Array# (<A HREF = "GHC.IOBase.html#t%3AIO"
		>IO</A
		> ()) -&gt; <A HREF = "GHC.IOBase.html#t%3AIO"
		>IO</A
		> ()</TD
	      ></TR
	    ></TABLE
	  ></TD
	></TR
      ><TR
      ><TD CLASS = "s15"
	></TD
	></TR
      ><TR
      ><TD CLASS = "section1"
	>Documentation</TD
	></TR
      ><TR
      ><TD CLASS = "s15"
	></TD
	></TR
      ><TR
      ><TD CLASS = "decl"
	><SPAN CLASS = "keyword"
	  >data</SPAN
	  > <A NAME = "t%3AWeak"
	  ></A
	  ><B
	  >Weak</B
	  > v</TD
	></TR
      ><TR
      ><TD CLASS = "body"
	><TABLE CLASS = "vanilla" CELLSPACING = "0" CELLPADDING = "0"
	  ><TR
	    ><TD CLASS = "ndoc"
	      ><P
		>A weak pointer object with a key and a value.  The value has type <TT
		  >v</TT
		  >.
</P
		><P
		>A weak pointer expresses a relationship between two objects, the
<EM
		  >key</EM
		  > and the <EM
		  >value</EM
		  >:  if the key is considered to be alive by the
garbage collector, then the value is also alive.  A reference from
the value to the key does <EM
		  >not</EM
		  > keep the key alive.
</P
		><P
		>A weak pointer may also have a finalizer of type <TT
		  >IO ()</TT
		  >; if it does,
then the finalizer will be run once, and once only, at a time after
the key has become unreachable by the program (&quot;dead&quot;).  The storage
manager attempts to run the finalizer(s) for an object soon after the
object dies, but promptness is not guaranteed.  
</P
		><P
		>References from the finalizer to the key are treated in the same way
as references from the value to the key: they do not keep the key
alive.  A finalizer may therefore ressurrect the key, perhaps by
storing it in the same data structure.
</P
		><P
		>The finalizer, and the relationship between the key and the value,
exist regardless of whether the program keeps a reference to the
<TT
		  ><A HREF = "GHC.Weak.html#t%3AWeak"
		    >Weak</A
		    ></TT
		  > object or not.
</P
		><P
		>There may be multiple weak pointers with the same key.  In this
case, the finalizers for each of these weak pointers will all be
run in some arbitrary order, or perhaps concurrently, when the key
dies.  If the programmer specifies a finalizer that assumes it has
the only reference to an object (for example, a file that it wishes
to close), then the programmer must ensure that there is only one
such finalizer.
</P
		><P
		>If there are no other threads to run, the runtime system will check
for runnable finalizers before declaring the system to be deadlocked.
</P
		></TD
	      ></TR
	    ><TR
	    ><TD CLASS = "section4"
	      >Constructors</TD
	      ></TR
	    ><TR
	    ><TD CLASS = "body"
	      ><TABLE CLASS = "vanilla" CELLSPACING = "1" CELLPADDING = "0"
		><TR
		  ><TD CLASS = "arg"
		    ><A NAME = "v%3AWeak"
		      ></A
		      ><B
		      >Weak</B
		      > (Weak# v)</TD
		    ><TD CLASS = "rdoc"
		    ></TD
		    ></TR
		  ></TABLE
		></TD
	      ></TR
	    ><TR
	    ><TD CLASS = "section4"
	      >Instances</TD
	      ></TR
	    ><TR
	    ><TD CLASS = "body"
	      ><TABLE CLASS = "vanilla" CELLSPACING = "1" CELLPADDING = "0"
		><TR
		  ><TD CLASS = "decl"
		    ><A HREF = "Data.Typeable.html#t%3ATypeable"
		      >Typeable</A
		      > a =&gt; <A HREF = "Data.Typeable.html#t%3ATypeable"
		      >Typeable</A
		      > (<A HREF = "GHC.Weak.html#t%3AWeak"
		      >Weak</A
		      > a)</TD
		    ></TR
		  ></TABLE
		></TD
	      ></TR
	    ></TABLE
	  ></TD
	></TR
      ><TR
      ><TD CLASS = "s15"
	></TD
	></TR
      ><TR
      ><TD CLASS = "decl"
	><A NAME = "v%3AmkWeak"
	  ></A
	  ><B
	  >mkWeak</B
	  ></TD
	></TR
      ><TR
      ><TD CLASS = "body"
	><TABLE CLASS = "vanilla" CELLSPACING = "0" CELLPADDING = "0"
	  ><TR
	    ><TD CLASS = "arg"
	      >:: k</TD
	      ><TD CLASS = "rdoc"
	      >key</TD
	      ></TR
	    ><TR
	    ><TD CLASS = "arg"
	      >-&gt; v</TD
	      ><TD CLASS = "rdoc"
	      >value</TD
	      ></TR
	    ><TR
	    ><TD CLASS = "arg"
	      >-&gt; <A HREF = "Data.Maybe.html#t%3AMaybe"
		>Maybe</A
		> (<A HREF = "GHC.IOBase.html#t%3AIO"
		>IO</A
		> ())</TD
	      ><TD CLASS = "rdoc"
	      >finalizer</TD
	      ></TR
	    ><TR
	    ><TD CLASS = "arg"
	      >-&gt; <A HREF = "GHC.IOBase.html#t%3AIO"
		>IO</A
		> (<A HREF = "GHC.Weak.html#t%3AWeak"
		>Weak</A
		> v)</TD
	      ><TD CLASS = "rdoc"
	      >returns: a weak pointer object</TD
	      ></TR
	    ><TR
	    ><TD CLASS = "ndoc" COLSPAN = "2"
	      ><P
		>Establishes a weak pointer to <TT
		  >k</TT
		  >, with value <TT
		  >v</TT
		  > and a finalizer.
</P
		><P
		>This is the most general interface for building a weak pointer.
</P
		></TD
	      ></TR
	    ></TABLE
	  ></TD
	></TR
      ><TR
      ><TD CLASS = "s15"
	></TD
	></TR
      ><TR
      ><TD CLASS = "decl"
	><A NAME = "v%3AdeRefWeak"
	  ></A
	  ><B
	  >deRefWeak</B
	  > :: <A HREF = "GHC.Weak.html#t%3AWeak"
	  >Weak</A
	  > v -&gt; <A HREF = "GHC.IOBase.html#t%3AIO"
	  >IO</A
	  > (<A HREF = "Data.Maybe.html#t%3AMaybe"
	  >Maybe</A
	  > v)</TD
	></TR
      ><TR
      ><TD CLASS = "doc"
	><P
	  >Dereferences a weak pointer.  If the key is still alive, then
<TT
	    ><TT
	      ><A HREF = "Data.Maybe.html#v%3AJust"
		>Just</A
		></TT
	      > v</TT
	    > is returned (where <TT
	    >v</TT
	    > is the <EM
	    >value</EM
	    > in the weak pointer), otherwise
<TT
	    ><A HREF = "Data.Maybe.html#v%3ANothing"
	      >Nothing</A
	      ></TT
	    > is returned.
</P
	  ><P
	  >The return value of <TT
	    ><A HREF = "GHC.Weak.html#v%3AdeRefWeak"
	      >deRefWeak</A
	      ></TT
	    > depends on when the garbage collector
runs, hence it is in the <TT
	    ><A HREF = "GHC.IOBase.html#t%3AIO"
	      >IO</A
	      ></TT
	    > monad.
</P
	  ></TD
	></TR
      ><TR
      ><TD CLASS = "s15"
	></TD
	></TR
      ><TR
      ><TD CLASS = "decl"
	><A NAME = "v%3Afinalize"
	  ></A
	  ><B
	  >finalize</B
	  > :: <A HREF = "GHC.Weak.html#t%3AWeak"
	  >Weak</A
	  > v -&gt; <A HREF = "GHC.IOBase.html#t%3AIO"
	  >IO</A
	  > ()</TD
	></TR
      ><TR
      ><TD CLASS = "doc"
	>Causes a the finalizer associated with a weak pointer to be run
immediately.</TD
	></TR
      ><TR
      ><TD CLASS = "s15"
	></TD
	></TR
      ><TR
      ><TD CLASS = "decl"
	><A NAME = "v%3ArunFinalizerBatch"
	  ></A
	  ><B
	  >runFinalizerBatch</B
	  > :: <A HREF = "GHC.Base.html#t%3AInt"
	  >Int</A
	  > -&gt; Array# (<A HREF = "GHC.IOBase.html#t%3AIO"
	  >IO</A
	  > ()) -&gt; <A HREF = "GHC.IOBase.html#t%3AIO"
	  >IO</A
	  > ()</TD
	></TR
      ><TR
      ><TD CLASS = "s15"
	></TD
	></TR
      ><TR
      ><TD CLASS = "botbar"
	>Produced by <A HREF = "http://www.haskell.org/haddock/"
	  >Haddock</A
	  > version 0.6</TD
	></TR
      ></TABLE
    ></BODY
  ></HTML
>
